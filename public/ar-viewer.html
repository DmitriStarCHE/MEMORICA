<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>WebAR Viewer</title>
    
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            text-align: center;
            padding: 20px;
        }
        
        .loading h1 {
            font-size: 2em;
            margin-bottom: 20px;
            color: #3498db;
        }
        
        .loading h2 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        #status {
            font-size: 1.1em;
            margin: 20px 0;
            min-height: 60px;
        }
        
        .error {
            background: #e74c3c;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            max-width: 400px;
        }
        
        .instructions {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 20px 10px;
            z-index: 999;
            display: none;
            font-size: 16px;
        }
        
        .camera-permission {
            background: #3498db;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            display: none;
            max-width: 400px;
        }
        
        button {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            margin: 10px 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #27ae60;
            transform: scale(1.05);
        }
        
        .reload-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            backdrop-filter: blur(10px);
            cursor: pointer;
        }
        
        .progress-bar {
            width: 300px;
            height: 6px;
            background: #333;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress {
            width: 0%;
            height: 100%;
            background: #3498db;
            transition: width 0.3s ease;
        }
        
        #arScene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .debug-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1002;
            display: none;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <h1>üåê WebAR Viewer</h1>
        <h2>–î–æ–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ</h2>
        
        <div id="status">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã...</div>
        
        <div class="progress-bar">
            <div class="progress" id="progress"></div>
        </div>
        
        <div class="camera-permission" id="cameraPermission">
            <h3>üì∑ –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ</h3>
            <p>–î–ª—è —Ä–∞–±–æ—Ç—ã AR –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–π –∫–∞–º–µ—Ä–µ</p>
            <button onclick="requestCameraAccess()">–†–∞–∑—Ä–µ—à–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
        </div>
        
        <div class="error" id="error"></div>
    </div>

    <button class="reload-btn" onclick="window.location.reload()">‚Üª</button>
    
    <div class="debug-info" id="debugInfo"></div>

    <div class="instructions" id="instructions">
        üéØ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è AR –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    </div>

    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        renderer="logarithmicDepthBuffer: true; antialias: true;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        id="arScene"
        style="display: none;">
        
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        class WebARViewer {
            constructor() {
                this.markerId = this.getUrlParameter('marker');
                this.sceneData = null;
                this.isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
                this.isAndroid = /Android/.test(navigator.userAgent);
                this.init();
            }

            getUrlParameter(name) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(name);
            }

            async init() {
                this.updateStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebAR...');
                this.updateProgress(10);
                
                if (!this.markerId) {
                    this.showError('‚ùå –û—à–∏–±–∫–∞: –Ω–µ —É–∫–∞–∑–∞–Ω ID –º–∞—Ä–∫–µ—Ä–∞ –≤ URL<br>–ü—Ä–∏–º–µ—Ä: /ar-viewer.html?marker=1');
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –±—Ä–∞—É–∑–µ—Ä–æ–º
                if (!this.checkBrowserSupport()) {
                    return;
                }

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã
                await this.loadSceneData();
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
                await this.requestCamera();
            }

            checkBrowserSupport() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ API
                const hasGetUserMedia = !!navigator.mediaDevices && !!navigator.mediaDevices.getUserMedia;
                const hasWebGL = this.checkWebGLSupport();
                
                if (!hasGetUserMedia) {
                    this.showError(`
                        ‚ùå –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ<br><br>
                        üì± –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:<br>
                        ‚Ä¢ Chrome –¥–ª—è Android<br>
                        ‚Ä¢ Safari –¥–ª—è iOS 11+<br>
                        ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é Firefox
                    `);
                    return false;
                }
                
                if (!hasWebGL) {
                    this.showError(`
                        ‚ùå WebGL –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è<br><br>
                        AR —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É WebGL –¥–ª—è —Ä–∞–±–æ—Ç—ã.<br>
                        –û–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ WebGL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.
                    `);
                    return false;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º HTTPS –¥–ª—è iOS
                if (this.isIOS && window.location.protocol !== 'https:') {
                    this.showError(`
                        üì± –î–ª—è iOS –Ω–µ–æ–±—Ö–æ–¥–∏–º HTTPS<br><br>
                        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç—É–Ω–Ω–µ–ª—å —Å HTTPS (Serveo) –∏–ª–∏ <br>
                        —Ä–∞–∑–º–µ—Å—Ç–∏—Ç–µ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
                    `);
                    return false;
                }
                
                this.debug('‚úÖ –ë—Ä–∞—É–∑–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WebAR');
                return true;
            }

            checkWebGLSupport() {
                try {
                    const canvas = document.createElement('canvas');
                    return !!(window.WebGLRenderingContext && 
                             (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
                } catch (e) {
                    return false;
                }
            }

            async loadSceneData() {
                try {
                    this.updateStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö AR...');
                    this.updateProgress(30);
                    
                    const response = await fetch(`/api/ar-scene/${this.markerId}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    this.sceneData = await response.json();
                    
                    if (!this.sceneData.marker) {
                        throw new Error('–ú–∞—Ä–∫–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö');
                    }
                    
                    this.debug('‚úÖ –î–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                    this.updateProgress(60);
                    
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                    this.showError(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`);
                }
            }

            async requestCamera() {
                this.updateStatus('–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...');
                this.updateProgress(80);
                
                try {
                    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π stream –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: {
                            facingMode: 'environment', // –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º –∑–∞–¥–Ω—é—é –∫–∞–º–µ—Ä—É
                            width: { ideal: 1280 },
                            height: { ideal: 720 },
                            aspectRatio: { ideal: 1.7777777778 }
                        }
                    });
                    
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π stream
                    stream.getTracks().forEach(track => track.stop());
                    
                    this.debug('‚úÖ –î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ —Ä–∞–∑—Ä–µ—à–µ–Ω');
                    this.updateProgress(100);
                    this.setupARScene();
                    
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', error);
                    
                    if (error.name === 'NotAllowedError') {
                        this.showCameraPermissionRequest();
                    } else if (error.name === 'NotFoundError') {
                        this.showError('üì∑ –ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ');
                    } else if (error.name === 'NotSupportedError') {
                        this.showError('üì∑ –ö–∞–º–µ—Ä–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                    } else {
                        this.showError(`–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã: ${error.message}`);
                    }
                }
            }

            showCameraPermissionRequest() {
                document.getElementById('cameraPermission').style.display = 'block';
                this.updateStatus('–û–∂–∏–¥–∞–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
                let helpText = '–ù–∞–∂–º–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å –∫–∞–º–µ—Ä—É" –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –¥–∏–∞–ª–æ–≥–µ –±—Ä–∞—É–∑–µ—Ä–∞';
                if (this.isIOS) {
                    helpText += '<br>–ù–∞ iOS: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ > Safari > –ö–∞–º–µ—Ä–∞ > –†–∞–∑—Ä–µ—à–∏—Ç—å';
                } else if (this.isAndroid) {
                    helpText += '<br>–ù–∞ Android: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è > –†–∞–∑—Ä–µ—à–µ–Ω–∏—è > –ö–∞–º–µ—Ä–∞';
                }
                
                document.getElementById('cameraPermission').innerHTML += `<p style="font-size: 14px; margin-top: 10px;">${helpText}</p>`;
            }

            setupARScene() {
                this.updateStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ AR —Å—Ü–µ–Ω—ã...');
                
                const scene = document.getElementById('arScene');
                scene.style.display = 'block';

                // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –º–∞—Ä–∫–µ—Ä—ã
                const oldMarkers = scene.querySelectorAll('a-marker');
                oldMarkers.forEach(marker => marker.remove());

                // –°–æ–∑–¥–∞–µ–º –º–∞—Ä–∫–µ—Ä —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
                const marker = document.createElement('a-marker');
                marker.setAttribute('type', 'pattern');
                marker.setAttribute('url', this.sceneData.marker.pattUrl);
                marker.setAttribute('emitevents', 'true');
                marker.setAttribute('smooth', 'true');
                marker.setAttribute('smoothCount', '5');
                marker.setAttribute('smoothTolerance', '0.01');
                marker.setAttribute('smoothThreshold', '2');

                // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç
                if (this.sceneData.contents && this.sceneData.contents.length > 0) {
                    this.debug(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ ${this.sceneData.contents.length} –æ–±—ä–µ–∫—Ç–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞`);
                    this.sceneData.contents.forEach((content, index) => {
                        const entity = this.createContentEntity(content, index);
                        marker.appendChild(entity);
                    });
                } else {
                    this.debug('‚ÑπÔ∏è –ö–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫—É–±');
                    // –¢–µ—Å—Ç–æ–≤—ã–π –∫—É–± –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–µ—Ç
                    const testCube = document.createElement('a-box');
                    testCube.setAttribute('position', '0 0.5 0');
                    testCube.setAttribute('rotation', '0 45 45');
                    testCube.setAttribute('color', '#4CC3D9');
                    testCube.setAttribute('scale', '0.5 0.5 0.5');
                    testCube.setAttribute('animation', 'property: rotation; to: 0 405 45; loop: true; dur: 5000');
                    marker.appendChild(testCube);
                    
                    const text = document.createElement('a-text');
                    text.setAttribute('value', '–¢–µ—Å—Ç–æ–≤—ã–π AR');
                    text.setAttribute('position', '0 1.2 0');
                    text.setAttribute('align', 'center');
                    text.setAttribute('color', '#FFF');
                    marker.appendChild(text);
                }

                scene.appendChild(marker);

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –º–∞—Ä–∫–µ—Ä–∞
                marker.addEventListener('markerFound', () => {
                    this.debug('üéØ –ú–∞—Ä–∫–µ—Ä —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω!');
                    document.getElementById('instructions').style.display = 'block';
                    
                    // –í–∏–±—Ä–∞—Ü–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
                    if (navigator.vibrate) {
                        navigator.vibrate(100);
                    }
                });

                marker.addEventListener('markerLost', () => {
                    this.debug('üîç –ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω');
                    document.getElementById('instructions').style.display = 'block';
                });

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ AR.js
                scene.addEventListener('arjs-error', (event) => {
                    console.error('AR.js Error:', event.detail);
                    this.showError(`AR –æ—à–∏–±–∫–∞: ${event.detail}`);
                });

                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                setTimeout(() => {
                    this.hideLoading();
                }, 1500);
            }

            createContentEntity(content, index) {
                const entity = document.createElement('a-entity');
                
                switch (content.contentType) {
                    case 'model':
                        entity.setAttribute('gltf-model', content.contentUrl);
                        entity.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 10000');
                        this.debug(`‚úÖ 3D –º–æ–¥–µ–ª—å: ${content.contentUrl}`);
                        break;
                        
                    case 'video':
                        const videoId = `video-${Date.now()}-${index}`;
                        this.createVideoElement(content.contentUrl, videoId);
                        entity.setAttribute('geometry', 'primitive: plane; width: 1.6; height: 0.9');
                        entity.setAttribute('material', `src: #${videoId}; transparent: true`);
                        entity.setAttribute('animation', {
                            property: 'material.opacity',
                            to: '1',
                            dur: '1000',
                            delay: index * 200
                        });
                        this.debug(`‚úÖ –í–∏–¥–µ–æ: ${content.contentUrl}`);
                        break;
                        
                    case 'image':
                        entity.setAttribute('geometry', 'primitive: plane; width: 1.5; height: 1.5');
                        entity.setAttribute('material', {
                            src: content.contentUrl,
                            transparent: true,
                            opacity: 0
                        });
                        entity.setAttribute('animation', {
                            property: 'material.opacity',
                            to: '1',
                            dur: '1000',
                            delay: index * 200
                        });
                        this.debug(`‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${content.contentUrl}`);
                        break;
                }

                // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                entity.setAttribute('position', content.position);
                entity.setAttribute('scale', content.scale);
                entity.setAttribute('rotation', content.rotation);

                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                entity.setAttribute('class', 'clickable');
                entity.setAttribute('cursor', 'rayOrigin: mouse');
                
                entity.addEventListener('click', () => {
                    this.onContentClick(content);
                });

                return entity;
            }

            createVideoElement(src, id) {
                const video = document.createElement('video');
                video.id = id;
                video.setAttribute('autoplay', 'true');
                video.setAttribute('loop', 'true');
                video.setAttribute('playsinline', 'true');
                video.setAttribute('webkit-playsinline', 'true');
                video.setAttribute('muted', 'true');
                video.setAttribute('crossorigin', 'anonymous');
                video.style.display = 'none';
                video.src = src;
                
                video.addEventListener('loadeddata', () => {
                    this.debug(`‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${src}`);
                });
                
                video.addEventListener('error', (e) => {
                    this.debug(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ: ${src}`);
                });
                
                document.body.appendChild(video);
            }

            onContentClick(content) {
                this.debug(`üñ±Ô∏è –ö–ª–∏–∫ –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É: ${content.contentType}`);
                
                // –í–∏–±—Ä–∞—Ü–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ
                // –ù–∞–ø—Ä–∏–º–µ—Ä, –∞–Ω–∏–º–∞—Ü–∏–∏, –∑–≤—É–∫–∏ –∏ —Ç.–¥.
            }

            updateStatus(message) {
                document.getElementById('status').textContent = message;
                this.debug(message);
            }

            updateProgress(percent) {
                document.getElementById('progress').style.width = percent + '%';
            }

            hideLoading() {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('instructions').style.display = 'block';
                this.debug('‚úÖ AR —Å—Ü–µ–Ω–∞ –≥–æ—Ç–æ–≤–∞');
            }

            showError(message) {
                document.getElementById('error').innerHTML = message;
                document.getElementById('error').style.display = 'block';
                document.getElementById('status').style.display = 'none';
                document.getElementById('progress').style.background = '#e74c3c';
            }

            debug(message) {
                console.log('üîß WebAR Debug:', message);
                const debugInfo = document.getElementById('debugInfo');
                debugInfo.innerHTML = message;
                debugInfo.style.display = 'block';
                
                // –ê–≤—Ç–æ-—Å–∫—Ä—ã—Ç–∏–µ debug —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    debugInfo.style.display = 'none';
                }, 5000);
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∫–∞–º–µ—Ä—ã
        function requestCameraAccess() {
            location.reload();
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', () => {
            new WebARViewer();
        });

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        document.addEventListener('touchmove', (e) => {
            if (e.scale !== 1) {
                e.preventDefault();
            }
        }, { passive: false });

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
        });
    </script>
</body>
</html>